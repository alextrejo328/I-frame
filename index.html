<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dashboard Ultra Clock</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
        /* --- RESET --- */
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }

        /* --- FONDO BASE Y ANIMACI√ìN --- */
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite; 
            color: #fff;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 1.5s ease-in-out, color 1s;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); 
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- MODOS D√çA/NOCHE --- */
        .night.clear { background: linear-gradient(135deg, #100a30, #222244, #3a2e5a); }
        .night.cloudy { background: linear-gradient(135deg, #2c3e50, #4a6c89, #547898); }
        .night.rainy { background: linear-gradient(135deg, #1a1a2e, #3a3a5a, #51517a); }
        .day.clear { background: linear-gradient(135deg, #4facfe, #00f2fe, #43e97b); }
        .day.cloudy { background: linear-gradient(135deg, #bdc3c7, #a2b0b7, #7f8c8d); }
        .day.rainy { background: linear-gradient(135deg, #475a6c, #637a8b, #8696a5); }
        
        /* --- ESTILOS GLASS-WIDGET --- */
        .glass-widget {
            position: relative; 
            overflow: hidden; 
            background: rgba(255, 255, 255, 0.15); 
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); 
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #fff;
            transition: all 0.5s;
        }

        body.day .glass-widget {
            background: rgba(0, 0, 0, 0.1); 
            border: 1px solid rgba(0, 0, 0, 0.15); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2); 
            color: #000;
        }
        
        body.day .glass-widget::before { background: rgba(255, 255, 255, 0.4); }
        body.day .time-text { text-shadow: 0 0 15px rgba(0,0,0,0.1); }
        body.day .today { background: #000; color: #fff; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
        body.day .date-group { border-right: 2px solid rgba(0,0,0,0.15); }
        body.day .cal-header, body.day .fx-header { border-bottom: 1px solid rgba(0,0,0,0.1); }
        
        .glass-widget::before {
            content: '';
            position: absolute;
            top: 0; left: -100%; width: 50%; height: 100%;
            background: rgba(255, 255, 255, 0.1); 
            transform: skewX(-20deg);
            animation: shine 8s infinite linear; 
            pointer-events: none;
        }

        @keyframes shine { 0% { left: -100%; } 100% { left: 150%; } }

        /* --- BOT√ìN FULLSCREEN --- */
        .fullscreen-btn {
            position: absolute; top: 15px; right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255,255,255,0.7);
            width: 35px; height: 35px; border-radius: 50%;
            cursor: pointer; z-index: 1000; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center;
            outline: none;
        }
        .fullscreen-btn:hover { background: rgba(255, 255, 255, 0.3); color: white; transform: scale(1.1); }

        /* --- LAYOUT PRINCIPAL --- */
        .dashboard-container { display: flex; width: 96vw; height: 92vh; gap: 15px; }
        .left-column { display: flex; flex-direction: column; width: 60%; gap: 15px; }
        .right-column { display: flex; flex-direction: column; width: 40%; gap: 15px; } /* Apilado vertical */

        /* --- WIDGETS IZQUIERDA --- */
        .time-widget { flex: 2; }
        .time-text {
            font-size: 18vh; font-weight: 900; line-height: 0.8; letter-spacing: -6px;
            text-shadow: 0 0 50px rgba(255,255,255,0.25); font-variant-numeric: tabular-nums;
            display: flex; align-items: flex-end; 
        }
        .blink { animation: blinker 1s step-start infinite; margin-top: -1vh; }
        @keyframes blinker { 50% { opacity: 0; } }
        .ampm-text { font-size: 3vh; font-weight: 600; margin-left: 10px; margin-bottom: 2vh; padding-bottom: 10px; }
        
        .info-widget { flex: 1; flex-direction: row; gap: 20px; padding: 0 20px; }
        .date-group { text-align: right; border-right: 2px solid rgba(255,255,255,0.15); padding-right: 20px; display: flex; flex-direction: column; justify-content: center; }
        .date-day { font-size: 4vh; font-weight: 700; text-transform: capitalize; line-height: 1.1; }
        .date-full { font-size: 1.8vh; opacity: 0.7; }
        .weather-group { display: flex; align-items: center; gap: 15px; text-align: left; }
        .w-icon { font-size: 5vh; }
        .w-temp { font-size: 5vh; font-weight: 600; line-height: 1; }
        .w-desc { font-size: 1.5vh; opacity: 0.8; text-transform: capitalize; }

        /* --- WIDGETS DERECHA (Calendario & FX) --- */
        .calendar-widget { 
            flex: 6; /* 60% del alto disponible */
            width: 100%; padding: 15px; justify-content: flex-start; 
        }
        .cal-header { width: 100%; text-align: center; font-size: 2.2vh; font-weight: 700; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; width: 100%; flex-grow: 1; align-content: start; }
        .cal-day-label { text-align: center; font-weight: bold; font-size: 1.4vh; opacity: 0.5; margin-bottom: 2px; }
        .cal-cell { aspect-ratio: 1; display: flex; justify-content: center; align-items: center; font-size: 1.6vh; border-radius: 50%; cursor: default; }
        .today { background: #fff; color: #0f2027; font-weight: 900; box-shadow: 0 0 15px rgba(255,255,255,0.7); }

        .fx-widget {
            flex: 4; /* 40% del alto disponible */
            width: 100%; padding: 10px 15px;
            justify-content: flex-start; flex-direction: column;
        }
        .fx-header {
            font-size: 1.8vh; font-weight: 700; margin-bottom: 5px; text-align: center;
            padding-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.1); width: 100%;
        }
        .fx-content {
            display: flex; flex-direction: column; align-items: center; 
            width: 100%; height: 100%; flex-grow: 1;
            justify-content: space-evenly;
        }
        .fx-rate-group { text-align: center; }
        .fx-rate { font-size: 3.5vh; font-weight: 900; line-height: 1; }
        .fx-change { font-size: 1.6vh; opacity: 0.8; font-weight: 600; margin-top: 2px; }
        .fx-up { color: #43e97b; } 
        .fx-down { color: #f26666; }

        /* Contenedor CR√çTICO para Chart.js para evitar que rompa el layout */
        .chart-wrapper {
            position: relative;
            width: 100%;
            flex-grow: 1;
            min-height: 0; /* Magia de Flexbox para permitir shrinking */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- MEDIA QUERIES --- */
        @media (max-width: 768px) and (orientation: portrait) {
            .dashboard-container { flex-direction: column; }
            .left-column, .right-column { width: 100%; }
            .left-column { flex: 50; }
            .right-column { flex: 50; flex-direction: row; } 
            .calendar-widget, .fx-widget { flex: 1; padding: 10px; }
            
            .time-text { font-size: 14vh; letter-spacing: -3px; }
            .info-widget { flex-direction: row; justify-content: space-evenly; gap: 10px; }
            .date-day { font-size: 3.5vh; }
            .fx-rate { font-size: 2.2vh; }
            .fx-header { font-size: 1.4vh; }
        }

        @media (max-height: 500px) and (orientation: landscape) {
            .left-column { width: 60%; gap: 8px; }
            .right-column { width: 40%; }
            .time-widget { flex: 60; padding: 0; } 
            .info-widget { flex: 40; padding: 5px; }
            .time-text { font-size: 35vh; line-height: 0.75; letter-spacing: -1.5vh; }
            .blink { margin-top: -2vh; }
            .date-day { font-size: 7vh; } .date-full { font-size: 2vh; }
            .w-temp { font-size: 7vh; } .w-icon { font-size: 7vh; }
            .ampm-text { font-size: 5vh; }
            
            .fx-rate { font-size: 4vh; }
            .fx-header { font-size: 2vh; }
        }
    </style>
</head>
<body>

    <button class="fullscreen-btn" onclick="toggleFull()" title="Pantalla completa">‚õ∂</button>

    <div class="dashboard-container">
        
        <div class="left-column">
            <div class="glass-widget time-widget">
                <div class="time-text">
                    <span id="hh">00</span><span class="blink">:</span><span id="mm">00</span><span id="ampm" class="ampm-text">AM</span>
                </div>
            </div>

            <div class="glass-widget info-widget">
                <div class="date-group">
                    <div class="date-day" id="day-name">D√≠a</div>
                    <div class="date-full" id="full-date">...</div>
                </div>
                <div class="weather-group">
                    <div class="w-icon" id="w-icon">...</div>
                    <div>
                        <div class="w-temp" id="w-temp">--¬∞</div>
                        <div class="w-desc" id="w-desc">Cargando...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-column">
            <div class="glass-widget calendar-widget">
                <div class="cal-header" id="month-year">Calendario</div>
                <div class="cal-grid" id="cal-grid"></div>
            </div>
            
            <div class="glass-widget fx-widget">
                <div class="fx-header">USD / MXN</div>
                <div class="fx-content">
                    <div class="fx-rate-group">
                        <div class="fx-rate" id="fx-rate">--.--</div>
                        <div class="fx-change" id="fx-change">--%</div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="fxChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- CONFIGURACI√ìN Y ESTADO ---
        let isDay = false;
        let weatherCondition = 'clear'; 
        let fxChartInstance = null; 

        // 1. PANTALLA COMPLETA (Cross-Browser)
        function toggleFull() {
            const doc = document.documentElement;
            if (!document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
                if (doc.requestFullscreen) doc.requestFullscreen();
                else if (doc.msRequestFullscreen) doc.msRequestFullscreen();
                else if (doc.mozRequestFullScreen) doc.mozRequestFullScreen();
                else if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.msExitFullscreen) document.msExitFullscreen();
                else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            }
        }

        // 2. FONDO DIN√ÅMICO
        function applyDynamicBackground() {
            const body = document.body;
            const now = new Date();
            const hour = now.getHours();
            isDay = (hour >= 7 && hour < 19); 
            
            body.className = ''; // Limpiar clases
            body.classList.add(isDay ? 'day' : 'night');
            body.classList.add(weatherCondition);
            
            // Actualizar color del gr√°fico si existe
            if (fxChartInstance) updateChartColors();
        }

        // 3. RELOJ
        function updateClock() {
            const now = new Date();
            let h = now.getHours();
            const m = String(now.getMinutes()).padStart(2, '0');
            const ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12; h = h ? h : 12; 
            
            document.getElementById('hh').innerText = String(h).padStart(2, '0');
            document.getElementById('mm').innerText = m;
            document.getElementById('ampm').innerText = ampm; 
            
            const dayName = now.toLocaleDateString('es-ES', { weekday: 'long' });
            document.getElementById('day-name').innerText = dayName;
            document.getElementById('full-date').innerText = now.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' });

            applyDynamicBackground();
        }

        // 4. CALENDARIO
        function buildCalendar() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const today = now.getDate();
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            
            document.getElementById('month-year').innerText = `${monthNames[month]} ${year}`;
            const grid = document.getElementById('cal-grid');
            grid.innerHTML = '';

            ['D','L','M','M','J','V','S'].forEach(d => {
                const el = document.createElement('div');
                el.className = 'cal-day-label'; el.innerText = d; grid.appendChild(el);
            });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for(let i=0; i<firstDay; i++) grid.appendChild(document.createElement('div'));
            for(let i=1; i<=daysInMonth; i++) {
                const cell = document.createElement('div');
                cell.className = 'cal-cell'; cell.innerText = i;
                if(i === today) cell.classList.add('today');
                grid.appendChild(cell);
            }
        }

        // 5. CLIMA
        async function fetchWeather() {
            try {
                // Coordenadas CDMX
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=19.43&longitude=-99.13&current_weather=true&timezone=America%2FMexico_City');
                if(!res.ok) throw new Error('API Error');
                const data = await res.json();
                
                const code = data.current_weather.weathercode;
                const temp = Math.round(data.current_weather.temperature);
                
                // Mapeo simple de c√≥digos WMO
                let icon = '‚òÄÔ∏è'; let desc = 'Despejado'; let cond = 'clear';
                if(code > 1 && code < 45) { icon = '‚òÅÔ∏è'; desc = 'Nublado'; cond = 'cloudy'; }
                else if(code >= 45 && code < 51) { icon = 'üå´Ô∏è'; desc = 'Niebla'; cond = 'cloudy'; }
                else if(code >= 51) { icon = 'üåßÔ∏è'; desc = 'Lluvia'; cond = 'rainy'; }
                
                document.getElementById('w-icon').innerText = icon;
                document.getElementById('w-temp').innerText = temp + '¬∞';
                document.getElementById('w-desc').innerText = desc;
                weatherCondition = cond;
                applyDynamicBackground();
            } catch (e) {
                console.log('Error clima:', e);
            }
        }

        // 6. TIPO DE CAMBIO Y GR√ÅFICO (Chart.js)
        function initChart(historyData) {
            const ctx = document.getElementById('fxChart').getContext('2d');
            const color = isDay ? '#000000' : '#ffffff';

            if(fxChartInstance) { fxChartInstance.destroy(); }

            fxChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: historyData.map(d => d.t),
                    datasets: [{
                        data: historyData.map(d => d.v),
                        borderColor: color,
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.4,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // CLAVE PARA QUE NO SE ROMPA
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: { x: { display: false }, y: { display: false } },
                    layout: { padding: 5 }
                }
            });
        }

        function updateChartColors() {
            if(!fxChartInstance) return;
            const newColor = isDay ? '#000000' : '#ffffff';
            fxChartInstance.data.datasets[0].borderColor = newColor;
            fxChartInstance.update();
        }

        async function fetchFX() {
            try {
                // SIMULACI√ìN DE DATOS (Para evitar claves de API en este ejemplo)
                // En producci√≥n usar√≠as una API real.
                const base = 19.50; // Valor base aproximado
                const randomVar = (Math.random() * 0.4) - 0.2;
                const current = (base + randomVar).toFixed(2);
                const prev = (base + randomVar - 0.05).toFixed(2);
                
                const diff = (current - prev).toFixed(2);
                const pct = ((diff/prev)*100).toFixed(2);

                // Generar historial simulado
                const history = [];
                for(let i=6; i>=0; i--) {
                    history.push({ t: i, v: (parseFloat(current) + (Math.random()*0.2 - 0.1)) });
                }
                history[history.length-1].v = parseFloat(current); // El √∫ltimo es el actual

                // Actualizar DOM
                document.getElementById('fx-rate').innerText = `$${current}`;
                const elChange = document.getElementById('fx-change');
                elChange.innerText = `${diff > 0 ? '+' : ''}${diff} (${pct}%)`;
                
                elChange.className = 'fx-change ' + (diff >= 0 ? 'fx-up' : 'fx-down');

                // Dibujar/Actualizar gr√°fico
                initChart(history);

            } catch (e) {
                console.error("Error FX", e);
                document.getElementById('fx-rate').innerText = "ERR";
            }
        }

        // --- INICIO ---
        window.onload = () => {
            updateClock();
            buildCalendar();
            fetchWeather();
            fetchFX();

            setInterval(updateClock, 1000);
            setInterval(fetchFX, 60000); // Actualizar FX cada minuto para ver cambios
            setInterval(fetchWeather, 900000);
            setInterval(buildCalendar, 3600000);
        };
    </script>
</body>
</html>
