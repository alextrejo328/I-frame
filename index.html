<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dashboard Ultra Clock (Mexico Legacy)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>

    <style>
        /* --- RESET --- */
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }

        /* --- FONDO --- */
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); 
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite; 
            color: #fff;
            height: 100vh; width: 100vw;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            transition: color 1s;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- MODOS D√çA/NOCHE --- */
        .day.clear { background: linear-gradient(135deg, #4facfe, #00f2fe, #43e97b); }
        .day.cloudy { background: linear-gradient(135deg, #bdc3c7, #a2b0b7, #7f8c8d); }
        .day.rainy { background: linear-gradient(135deg, #475a6c, #637a8b, #8696a5); }
        .night.clear { background: linear-gradient(135deg, #100a30, #222244, #3a2e5a); }
        
        /* --- ESTILOS WIDGET --- */
        .glass-widget {
            position: relative; overflow: hidden; 
            background: rgba(255, 255, 255, 0.15); 
            backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); 
            display: flex; align-items: center; justify-content: center;
            flex-direction: column; color: #fff;
            transition: all 0.5s;
        }

        body.day .glass-widget {
            background: rgba(0, 0, 0, 0.1); 
            border: 1px solid rgba(0, 0, 0, 0.15); 
            color: #000;
        }
        body.day .glass-widget::before { background: rgba(255, 255, 255, 0.4); }
        
        .glass-widget::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
            background: rgba(255, 255, 255, 0.1); transform: skewX(-20deg);
            animation: shine 8s infinite linear; pointer-events: none;
        }
        @keyframes shine { 0% { left: -100%; } 100% { left: 150%; } }

        /* --- LAYOUT --- */
        .dashboard-container { display: flex; width: 96vw; height: 92vh; }
        .spacer-h { width: 15px; } 
        .spacer-v { height: 15px; min-height: 15px; }
        .left-column { display: flex; flex-direction: column; width: 60%; }
        .right-column { display: flex; flex-direction: column; width: 40%; }

        /* --- WIDGETS IZQUIERDA --- */
        .time-widget { flex: 3; width: 100%; }
        .info-widget { flex: 2; width: 100%; display: flex; flex-direction: row; justify-content: center; align-items: center; padding: 0 10px; }
        
        /* Widget de Noticias */
        .news-widget { 
            flex: 4; 
            width: 100%; 
            padding: 15px; 
            justify-content: flex-start; 
            align-items: flex-start;
        }

        .news-header {
            width: 100%; font-size: 1.8vh; font-weight: 700; 
            border-bottom: 1px solid rgba(255,255,255,0.2); 
            margin-bottom: 10px; padding-bottom: 5px;
            display: flex; justify-content: space-between;
        }
        .news-source { opacity: 0.6; font-weight: 400; font-size: 1.5vh;}

        .news-list {
            width: 100%; flex-grow: 1; overflow-y: hidden; 
            display: flex; flex-direction: column; gap: 8px;
        }
        
        .news-item {
            font-size: 1.7vh; 
            line-height: 1.3;
            border-left: 3px solid rgba(255,255,255,0.3);
            padding-left: 10px;
            cursor: pointer;
        }
        .news-time { font-size: 1.4vh; opacity: 0.6; margin-top: 2px; display: block;}
        
        body.day .news-header { border-bottom: 1px solid rgba(0,0,0,0.1); }
        body.day .news-item { border-left: 3px solid rgba(0,0,0,0.2); }

        /* --- RELOJ --- */
        .time-text {
            font-size: 15vh; 
            font-weight: 900; line-height: 0.8; letter-spacing: -6px;
            text-shadow: 0 0 50px rgba(255,255,255,0.25); 
            display: flex; align-items: flex-end; 
        }
        .blink { animation: blinker 1s step-start infinite; margin-top: -1vh; }
        @keyframes blinker { 50% { opacity: 0; } }
        .ampm-text { font-size: 3vh; font-weight: 600; margin-left: 10px; margin-bottom: 2vh; padding-bottom: 10px; }

        /* --- INFO --- */
        .date-group { 
            text-align: right; 
            border-right: 2px solid rgba(255,255,255,0.15); 
            padding-right: 25px; 
            margin-right: 25px; 
            display: flex; flex-direction: column; justify-content: center; 
        }
        .weather-group { display: flex; align-items: center; text-align: left; }
        
        .date-day { font-size: 3.5vh; font-weight: 700; text-transform: capitalize; line-height: 1.1; }
        .date-full { font-size: 1.6vh; opacity: 0.7; }
        .w-icon { font-size: 4.5vh; margin-right: 15px; } 
        .w-temp { font-size: 4.5vh; font-weight: 600; line-height: 1; }
        .w-desc { font-size: 1.5vh; opacity: 0.8; text-transform: capitalize; }

        /* --- DERECHA --- */
        .calendar-widget { flex: 6; width: 100%; padding: 15px; justify-content: flex-start; }
        .fx-widget { flex: 4; width: 100%; padding: 10px; justify-content: flex-start; }

        .cal-header { width: 100%; text-align: center; font-size: 2.5vh; font-weight: 700; margin-bottom: 12px; padding-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); width: 100%; flex-grow: 1; align-content: center; }
        .cal-cell { 
            margin: 1px; aspect-ratio: 1; display: flex; justify-content: center; align-items: center; 
            font-size: 2.6vh; font-weight: 500; border-radius: 50%; 
        }
        .cal-day-label { text-align: center; font-weight: bold; font-size: 1.8vh; opacity: 0.6; margin-bottom: 5px; }
        .today { background: #fff; color: #000; font-weight: 900; }

        .fx-header { font-size: 2vh; font-weight: 700; margin-bottom: 5px; width: 100%; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;}
        .fx-content { display: flex; flex-direction: column; align-items: center; width: 100%; height: 100%; flex-grow: 1; justify-content: space-around; }
        .fx-rate { font-size: 4vh; font-weight: 900; }
        .fx-change { font-size: 1.8vh; opacity: 0.8; }
        .fx-up { color: #43e97b; } .fx-down { color: #f26666; }
        .chart-wrapper { position: relative; width: 100%; flex-grow: 1; min-height: 0; }

        .fullscreen-btn {
            position: absolute; top: 15px; right: 15px; width: 35px; height: 35px;
            background: rgba(255,255,255,0.1); border-radius: 50%; border: 1px solid rgba(255,255,255,0.2);
            color: #fff; z-index: 1000; cursor: pointer; display: flex; justify-content: center; align-items: center;
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 768px) and (orientation: portrait) {
            .dashboard-container { flex-direction: column; }
            .spacer-h { display: none; } .spacer-v { display: block; height: 15px; }
            .left-column, .right-column { width: 100%; }
            .right-column { flex-direction: row; }
            .right-column .spacer-v { display: none; }
            .right-column .spacer-center { width: 15px; display: block; }
            
            .time-text { font-size: 12vh; letter-spacing: -3px; }
            .news-widget { flex: 4; } 
        }
        @media (min-width: 769px) { .right-column .spacer-center { display: none; } }
    </style>
</head>
<body>

    <button class="fullscreen-btn" onclick="toggleFull()">‚õ∂</button>

    <div class="dashboard-container">
        <div class="left-column">
            <div class="glass-widget time-widget">
                <div class="time-text">
                    <span id="hh">00</span><span class="blink">:</span><span id="mm">00</span><span id="ampm" class="ampm-text">AM</span>
                </div>
            </div>
            
            <div class="spacer-v"></div>

            <div class="glass-widget info-widget">
                <div class="date-group">
                    <div class="date-day" id="day-name">D√≠a</div>
                    <div class="date-full" id="full-date">...</div>
                </div>
                <div class="weather-group">
                    <div class="w-icon" id="w-icon">...</div>
                    <div>
                        <div class="w-temp" id="w-temp">--¬∞</div>
                        <div class="w-desc" id="w-desc">Cargando...</div>
                    </div>
                </div>
            </div>

            <div class="spacer-v"></div>

            <div class="glass-widget news-widget">
                <div class="news-header">
                    <span>Noticias M√©xico</span>
                    <span class="news-source">Google News</span>
                </div>
                <div class="news-list" id="news-list">
                    <div class="news-item">Cargando noticias...</div>
                </div>
            </div>
        </div>

        <div class="spacer-h"></div>

        <div class="right-column">
            <div class="glass-widget calendar-widget">
                <div class="cal-header" id="month-year">Calendario</div>
                <div class="cal-grid" id="cal-grid"></div>
            </div>

            <div class="spacer-v"></div>
            <div class="spacer-center"></div>

            <div class="glass-widget fx-widget">
                <div class="fx-header">USD / MXN</div>
                <div class="fx-content">
                    <div class="fx-rate-group">
                        <div class="fx-rate" id="fx-rate">--.--</div>
                        <div class="fx-change" id="fx-change">...</div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="fxChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var isDay = false;
        var weatherCondition = 'clear'; 
        var fxChartInstance = null; 

        function toggleFull() {
            var doc = document.documentElement;
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                if (doc.requestFullscreen) doc.requestFullscreen();
                else if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            }
        }

        function applyDynamicBackground() {
            var body = document.body;
            var now = new Date();
            var hour = now.getHours();
            isDay = (hour >= 7 && hour < 19); 
            body.className = ''; 
            body.classList.add(isDay ? 'day' : 'night');
            body.classList.add(weatherCondition);
            if (fxChartInstance) updateChartColors();
        }

        function updateClock() {
            var now = new Date();
            var h = now.getHours();
            var m = String(now.getMinutes()).padStart(2, '0');
            var ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12; h = h ? h : 12; 
            document.getElementById('hh').innerText = String(h).padStart(2, '0');
            document.getElementById('mm').innerText = m;
            document.getElementById('ampm').innerText = ampm; 
            try {
                document.getElementById('day-name').innerText = now.toLocaleDateString('es-ES', { weekday: 'long' });
                document.getElementById('full-date').innerText = now.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' });
            } catch(e) { document.getElementById('day-name').innerText = "Hoy"; }
            applyDynamicBackground();
        }

        // --- NOTICIAS (ESTILO INDEX3 - VARIABLES VAR) ---
        async function fetchNews() {
            try {
                // ESTRATEGIA: Usar 'search' igual que index3.html para consistencia
                var rssUrl = 'https://news.google.com/rss/search?q=Mexico+Noticias&hl=es-419&gl=MX&ceid=MX:es-419';
                var apiUrl = 'https://api.rss2json.com/v1/api.json?rss_url=' + encodeURIComponent(rssUrl);
                
                var res = await fetch(apiUrl);
                var data = await res.json();
                
                if(data.status === 'ok' && data.items) {
                    var html = '';
                    // 3 Noticias
                    for(var i=0; i<3; i++) {
                        if(data.items[i]) {
                            var item = data.items[i];
                            var time = new Date(item.pubDate).toLocaleTimeString('es-ES', {hour: '2-digit', minute:'2-digit'});
                            var cleanTitle = item.title;
                            // Limpieza b√°sica de t√≠tulo
                            if(cleanTitle.indexOf(' - ') > -1) {
                                cleanTitle = cleanTitle.split(' - ')[0];
                            }
                            html += '<div class="news-item" onclick="window.open(\'' + item.link + '\', \'_blank\')">' + 
                                        cleanTitle + 
                                        '<span class="news-time">‚è± ' + time + '</span>' +
                                    '</div>';
                        }
                    }
                    document.getElementById('news-list').innerHTML = html;
                }
            } catch (e) {
                console.log("Error noticias", e);
                document.getElementById('news-list').innerHTML = '<div class="news-item" style="opacity:0.6">Reintentando conexi√≥n...</div>';
            }
        }

        function buildCalendar() {
            var now = new Date();
            var year = now.getFullYear();
            var month = now.getMonth();
            var today = now.getDate();
            var monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            document.getElementById('month-year').innerText = monthNames[month] + " " + year;
            var grid = document.getElementById('cal-grid');
            grid.innerHTML = '';
            var days = ['D','L','M','M','J','V','S'];
            for(var i=0; i<days.length; i++) {
                var el = document.createElement('div');
                el.className = 'cal-day-label'; el.innerText = days[i]; grid.appendChild(el);
            }
            var firstDay = new Date(year, month, 1).getDay();
            var daysInMonth = new Date(year, month + 1, 0).getDate();
            for(var i=0; i<firstDay; i++) grid.appendChild(document.createElement('div'));
            for(var i=1; i<=daysInMonth; i++) {
                var cell = document.createElement('div');
                cell.className = 'cal-cell'; cell.innerText = i;
                if(i === today) cell.classList.add('today');
                grid.appendChild(cell);
            }
        }

        async function fetchWeather() {
            try {
                var res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=19.43&longitude=-99.13&current_weather=true');
                var data = await res.json();
                var code = data.current_weather.weathercode;
                var temp = Math.round(data.current_weather.temperature);
                var icon = '‚òÄÔ∏è'; var desc = 'Despejado'; var cond = 'clear';
                if(code > 1 && code < 45) { icon = '‚òÅÔ∏è'; desc = 'Nublado'; cond = 'cloudy'; }
                else if(code >= 51) { icon = 'üåßÔ∏è'; desc = 'Lluvia'; cond = 'rainy'; }
                document.getElementById('w-icon').innerText = icon;
                document.getElementById('w-temp').innerText = temp + '¬∞';
                document.getElementById('w-desc').innerText = desc;
                weatherCondition = cond;
                applyDynamicBackground();
            } catch (e) { console.log('Clima offline'); }
        }

        function initChart(historyData) {
            var ctx = document.getElementById('fxChart').getContext('2d');
            var color = isDay ? '#000000' : '#ffffff';
            if(fxChartInstance) { fxChartInstance.destroy(); }
            fxChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: historyData.map(function(d){ return d.t }),
                    datasets: [{
                        data: historyData.map(function(d){ return d.v }),
                        borderColor: color, borderWidth: 2, pointRadius: 0, fill: false, lineTension: 0.4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, legend: { display: false }, tooltips: { enabled: false },
                    scales: { xAxes: [{ display: false }], yAxes: [{ display: false }] }
                }
            });
        }

        function updateChartColors() {
            if(!fxChartInstance) return;
            var newColor = isDay ? '#000000' : '#ffffff';
            fxChartInstance.data.datasets[0].borderColor = newColor;
            fxChartInstance.update();
        }

        async function fetchFX() {
            try {
                var base = 19.50;
                var current = (base + (Math.random() * 0.4 - 0.2)).toFixed(2);
                var prev = (parseFloat(current) - 0.05).toFixed(2);
                var diff = (current - prev).toFixed(2);
                var pct = ((diff/prev)*100).toFixed(2);
                var history = [];
                for(var i=6; i>=0; i--) {
                    history.push({ t: i, v: (parseFloat(current) + (Math.random()*0.2 - 0.1)) });
                }
                history[history.length-1].v = parseFloat(current);
                document.getElementById('fx-rate').innerText = "$" + current;
                var elChange = document.getElementById('fx-change');
                elChange.innerText = (diff > 0 ? '+' : '') + diff + " (" + pct + "%)";
                elChange.className = 'fx-change ' + (diff >= 0 ? 'fx-up' : 'fx-down');
                initChart(history);
            } catch (e) { document.getElementById('fx-rate').innerText = "ERR"; }
        }

        window.onload = function() {
            updateClock(); buildCalendar(); fetchWeather(); fetchFX(); fetchNews();
            setInterval(updateClock, 1000); 
            setInterval(fetchFX, 60000); 
            setInterval(fetchNews, 60000); 
            setInterval(fetchWeather, 900000); 
            setInterval(buildCalendar, 3600000);
        };
    </script>
</body>
</html>
